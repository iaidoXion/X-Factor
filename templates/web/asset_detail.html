{% extends 'base.html' %}
{% load web_filter %}
{% block content %}
{% load static %}

<script src="{% static 'js/jquery/jquery-3.6.0.min.js' %}"></script>
<script src="{% static 'js/jquery/ajax.jquery.min.js' %}"></script>
<script src="{% static 'js/jquery/httpRequest.js' %}"></script>

</style>
<script>
	function send_api(data){
        $.ajax({
            type:"GET",
            url:"api",
            async : false,
			data : {
				"cid" : data
			},
            success : function(data){
				alert('success');
				console.log(data);
			},
            error : function(data1){
                alert('호출실패');
                alert(JSON.stringify(data1));
            }
        });


	}
</script>
<script>
    $(document).ready(function(){
        $("select[name=menu]").change(function () {
        this.form.submit();
        location.href='../asset_detail/?swv={{ swv }}&menu=' + $("#menu").val();
        });
	history.replaceState({},null,'../asset_detail/?swv={{ swv }}');
	$("#menu").val("{{ count }}").prop("selected",true);
    });

</script>
<script>
	$(document).ready( function() {
		$(".caret").click( function() {
			$(this).parents().next(".hide").slideToggle();
		});
	});
</script>
<!-- BEGIN #content -->
<div id="content" class="app-content">
	<!-- BEGIN page-header -->
	<h1 class="page-header">
		보안 취약점 진단 상세
	</h1>
	<!-- END page-header -->
	<!-- BEGIN row -->
	<div class="row">
		<!-- BEGIN card-body -->
		<div class="card mb-2">
			<div class="card-body px-16px py-8px">
				<div class="detail-content">
					<ul>
						{% if data %}
							<li>분류 : {{data.0.SWV}}</li>
							<li>진단 항목 : {{data.0.Title}}</li>
							<li>진단 항목 설명: {{data.0.Text}}</li>
							<li>판단기준:
								<p>- {{data.0.Judge.0}}</p>
								<p>- {{data.0.Judge.1}}</p>
							</li>
						{% else %}
							<li> Data 연동에 실패했습니다 </li>
						{% endif%}
					</ul>
				</div>
			</div>
			<div class="card-arrow">
				<div class="card-arrow-top-left"></div>
				<div class="card-arrow-top-right"></div>
				<div class="card-arrow-bottom-left"></div>
				<div class="card-arrow-bottom-right"></div>
			</div>
		</div>
		<div class="card-body">
			<div class="d-flex align-items-center mb-2">
				<!-- BEGIN #weak detail datatable -->
				<div class="datatable w-100">
					<div class="card">
						<div class="ex">
						</div>
						<div class="card-body" id='swv_api'>
							<div>
							페이지당
								<label>

									<form action="{% url 'asset_detail' %}" method="GET" id="count_menu" >
										<select class="form-select for-select-sm" name="menu" id="menu">
s												<option value="10">10</option>
												<option value="20">20</option>
												<option value="30">30</option>
										</select>
									</form>
								</label>
							 개씩 보기
							</div>
							<table id="weakTableDetail" class="table weakDetail text-nowrap" width="100%">
								<thead>
								<tr>
									<th>No</th>
									<th>컴퓨터 ID</th>
									<th>호스트 이름</th>
									<th>OS 버전</th>
									<th>IP 주소</th>
									<th>자산 타입</th>
									<th>접속 일자</th>
									<th>자산 상세</th>
								</tr>
								</thead>
								<tbody>
									{% if data %}
									{% for item in data %}
										<tr class="item">
											<td>{{forloop.counter0|add:data.start_index }}</td>
											<td>{{item.cid}}</td>
											<td>{{item.cpnm}}</td>
											<td>{{item.os}}</td>
											<td>{{item.ip}}</td>
											<td>{{item.type}}</td>
											<td>{{item.last_login}}</td>
											<td><i class="caret"></i></td><!--<button style="display:none;" type="button" class="btn btn-warning me-2" value=" " data-bs-toggle="modal" data-bs-target="#modalXl" onclick="send_api({{item}});">확인</button>-->
										</tr>
										<tr class="hide" style="display: none;">
											<td colspan="8">자산 상세 정보</td>
										</tr>
									{% endfor %}
									{% else %}
									<tr>
										<td colspan="8">
											----------------------------------------------------------------------------------
											----------------------------------------------------------------------------------
											----------------------------------------------------------------------------------
										</td>
									</tr>
									{% endif%}
								</tbody>
							</table>
							<div class="row align-items-center">
								{% if start and end and total %}
								<div> 현재 {{ start }} 건 - {{ end }} / 전체 {{ total}} 건 </div>
								{% endif %}
								<ul class="pagination justify-content-center">
									{% if data.has_previous and count%}
									<li class="page-item">
										<a class="page-link" href="?swv={{ swv }}&menu={{ count }}&page={{ data.previous_page_number }}">이전</a>
									</li>
									{% else %}
									<li class="page-item disabled">
										<a class="page-link" tabindex="-1" aria-disabled="true" href="#">이전</a>
									</li>
									{% endif %}

									{% for page_number in data.paginator.page_range %}
									{% if page_number == data.number %}
									<li class="page-item active" aria-current="page">
										<a class="page-link" href="?swv={{ swv }}&menu={{ count }}&page={{ page_number }}">{{ page_number }}</a>
									</li>
									{% else %}
									<li class="page-item">
										<a class="page-link" href="?swv={{ swv }}&menu={{ count }}&page={{ page_number }}">{{ page_number }}</a>
									</li>
									{% endif %}
									{% endfor %}

									{% if data.has_next %}
									<li class="page-item">
										<a class="page-link" href="?swv={{ swv }}&menu={{ count }}&page={{ data.next_page_number }}">다음</a>
									</li>
									{% else %}
									<li class="page-item disabled">
										<a class="page-link" tabindex="-1" aria-disabled="true" href="#">다음</a>
									</li>
									{% endif %}
								</ul>
							</div>
						</div>
						<div class="card-arrow">
							<div class="card-arrow-top-left"></div>
							<div class="card-arrow-top-right"></div>
							<div class="card-arrow-bottom-left"></div>
							<div class="card-arrow-bottom-right"></div>
						</div>
					</div>
				</div>
				<!-- END #weak detail datatable -->
			</div>
		</div>
		<!-- END card-body -->
	</div>
	<!-- END row -->
	<div class="modal fade border-none" id="modalXl">
		<div class="modal-dialog modal-xl">
			<div class="modal-content">
				<div class="weak-wrap">
					<div class="weak-item weak-id">
						<span id = 'cid'><i class="fas fa-user fa-fw me-1"></i></span>
						<span>{{CPIDV}}</span>
					</div>
					<div class="weak-item weak-content">
						<span class="weak-title">양호:</span>
						<span class="weak-num">30(개)</span>
						<span class="weak-title">취약:</span>
						<span class="weak-num">10(개)</span>
					</div>
					<div class="weak-item weak-state">
						<select id="weak-box" class="form-select form-select-sm weakBox">
							<option value="" selected>전체</option>
							<option value="양호">양호</option>
							<option value="취약">취약</option>
						</select>
					</div>
				</div>
				<!-- BEGIN #weak detail modal table datatable -->
				<div id="weakTableModal" class="datatable w-100 h-100" style="margin: 0 auto;">
					<div class="card" >
						<div class="card-body">
							<table id="weakTableDetail_modal" class="table weakModal text-nowrap w-100">
								<thead>
								<tr>
									<th>No</th>
									<th>진단 항목</th>
									<th>상태</th>
									<th>판단 기준</th>
								</tr>
								</thead>
								<tbody>
								<tr>
									<td>1</td>
									<td>관리자 계정 이름 변경 여부
										<span class="weak-tooltip">
												<i class="fas fa-exclamation-circle"></i>
												<span class="weak-tooltip-text">진단 항목 설명: 일반적으로 관리자 계정을 Administrator로 설정한 경우 로그온 시도 실패 횟수의 제한이 없는 점을 이용해 악의적인 사용자가 패스워드 유추 공격을 계속해서 시도할 수 있으므로 점검한다.</span>
										</span>
									</td>
									<td>양호</td>
									<td>
										<span class="state-tooltip">
											<i class="fas fa-plus-square"></i>
											<span class="state-tooltip-text">판단 기준:<br>
											- 양호: Administrator Default 계정 이름을 변경한 경우<br>- 취약: Administrator Default 계정 이름을 변경하지 않은 경우</span>
										</span>
									</td>
								</tr>
								<tr>
									<td>2</td>
									<td>게스트 계정 활성화 여부</td>
									<td>취약</td>
									<td></td>
								</tr>
								<tr>
									<td>3</td>
									<td>현재 계정 외 활성화 여부</td>
									<td>취약</td>
									<td></td>
								</tr>
								<tr>
									<td>4</td>
									<td>계정 잠금 횟수 설정 여부</td>
									<td>양호</td>
									<td></td>
								</tr>
								<tr>
									<td>5</td>
									<td>해독 가능 암호화 사용 여부</td>
									<td>양호</td>
									<td></td>
								</tr>
								<tr>
									<td>6</td>
									<td>관리자 그룹의 추가 관리자 활성화 여부</td>
									<td>양호</td>
									<td></td>
								</tr>
								<tr>
									<td>7</td>
									<td>Everyone 사용 권한 적용 여부</td>
									<td>양호</td>
									<td></td>
								</tr>
								<tr>
									<td>8</td>
									<td>계정 잠금 기간 설정 여부</td>
									<td>취약</td>
									<td></td>
								</tr>
								<tr>
									<td>9</td>
									<td>패스워드 복잡성 설정 여부</td>
									<td>취약</td>
									<td></td>
								</tr>
								<tr>
									<td>10</td>
									<td>패스워드 최소 암호 길이 설정 여부</td>
									<td>양호</td>
									<td></td>
								</tr>
								<tr>
									<td>11</td>
									<td>패스워드 최대 사용 기간 설정 여부</td>
									<td>양호</td>
									<td></td>
								</tr>
								<tr>
									<td>12</td>
									<td>패스워드 최소 사용 기간 설정 여부</td>
									<td>양호</td>
									<td></td>
								</tr>
								<tr>
									<td>13</td>
									<td>마지막 사용자 이름 표시 여부</td>
									<td>취약</td>
									<td></td>
								</tr>
								<tr>
									<td>14</td>
									<td>비지정 사용자의 로컬 로그온 허용 여부</td>
									<td>양호</td>
									<td></td>
								</tr>
								<tr>
									<td>15</td>
									<td>익명 SID 변환 허용 여부</td>
									<td>양호</td>
									<td></td>
								</tr>
								<tr>
									<td>16</td>
									<td>최근 암호 기억 설정 여부</td>
									<td>양호</td>
									<td></td>
								</tr>
								<tr>
									<td>17</td>
									<td>콘솔 로그온 시 로컬에서 빈 암호 사용 제한 여부</td>
									<td>양호</td>
									<td></td>
								</tr>
								</tbody>
							</table>
						</div>
						<div class="card-arrow">
							<div class="card-arrow-top-left"></div>
							<div class="card-arrow-top-right"></div>
							<div class="card-arrow-bottom-left"></div>
							<div class="card-arrow-bottom-right"></div>
						</div>
					</div>
				</div>
				<!-- END #weak detail modal table datatable -->
			</div>
		</div>
	</div>
</div>
<!-- END #content -->




{% endblock %}
